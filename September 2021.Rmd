---
title: "Daily R - September 2021"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  fig.retina = 3,
  fig.path = here::here("exports", "September", "/")
)

pacman::p_load(pacman, tidyverse, janitor, here, rio, job, skimr, paletteer)

theme_set(theme_bw(base_size = 15))

```

# 20210901 - Parents' Portland Trip

```{r, include = F}
p_load(rnaturalearth, rnaturalearthdata, sf, maps, patchwork, elevatr, raster, ggrepel, usmap)

world <- ne_countries(scale = "medium", returnclass = "sf")

usa <- subset(world, admin %in% c("United States of America", "Canada", "Mexico"))

stops <- import("or_trip.xlsx")

states <- st_as_sf(map("state", plot = FALSE, fill = TRUE, labels = T)) %>% 
  mutate(st_name = str_to_title(ID))

states <- cbind(states, st_coordinates(st_centroid(states)))

test <- st_centroid(states, of_largest_polygon = T)

#browseURL("https://r-spatial.org/r/2018/10/25/ggplot2-sf-2.html")

#browseURL("https://cran.r-project.org/web/packages/usmap/vignettes/advanced-mapping.html")

plot_usmap("states", labels = T)

```

```{r}
(trip_map <- ggplot(usa) + 
  geom_sf(fill = "beige", color = "black", size = 0.05) +
  geom_point(data = stops, aes(x = lon, y = lat), size = 2) + 
  scale_x_continuous(limits = c(-125, -90)) + 
  scale_y_continuous(limits = c(32, 50)) + 
  geom_sf(data = states, fill = NA, size = 0.25) + 
#  geom_text(data = states, aes(label = st_name)) +
  geom_segment(data = stops, aes(x = lon, y = lat, 
                    xend=c(tail(lon, n=-1), NA), 
                    yend=c(tail(lat, n=-1), NA)
                  ), lty = 2) +
  geom_label_repel(data = stops, aes(label = stop, x = lon, y = lat))+
  coord_sf() + 
  theme_void() + 
  theme(panel.background = element_rect(fill = "steelblue4"))
)


(trip_legend <- stops %>% 
  mutate(legend = 1) %>% 
  head(-1) %>% 
  ggplot(aes(legend, reorder(name, -stop))) + 
  geom_text(aes(label = paste0(stop, ":"))) +
  labs(x = NULL, y = NULL) +
  scale_y_discrete(position = "right") +
  scale_x_discrete(labels = NULL) + 
  theme_classic(base_size = 15, base_line_size = 0) +
  theme(axis.text = element_text(color = "black"))
)

trip_map + trip_legend + plot_layout(widths = c(10, 0.5), heights = 10)


(trip_map2 <- ggplot(usa) + 
  geom_sf(fill = "beige", color = "black", size = 0.05) +
  geom_point(data = stops, aes(x = lon, y = lat), size = 2) + 
  scale_x_continuous(limits = c(-125, -90)) + 
  scale_y_continuous(limits = c(32, 50)) + 
  geom_sf(data = states, fill = NA, size = 0.25) + 
  geom_text(data = states, aes(X, Y, label = st_name), size = 5) + 
  geom_segment(data = stops, aes(x = lon, y = lat, 
                    xend=c(tail(lon, n=-1), NA), 
                    yend=c(tail(lat, n=-1), NA)
                  ), lty = 2) +
  geom_label_repel(data = stops, aes(label = stop, x = lon, y = lat))+
  coord_sf() + 
  theme_void() + 
  theme(panel.background = element_rect(fill = "steelblue4"))
)
```

```{r, include = F}
crop_usa <- st_crop(usa, ymin = 32, ymax = 50, 
                xmin = -125, xmax = -90)

ggplot(crop_usa) + 
  geom_sf(fill = "white", color = "black", size = 0.05)

elevation1 <- get_elev_raster(test, z = 8)

plot(elevation1)

crs(elevation1)

elevation <- raster::crop(elevation1, extent(crop_usa))

plot(elevation)

test3 <- st_crop(test2, ymin = 32, ymax = 50, 
                 xmin = -125, xmax = -90)
```

# 20210902 and 20210903 - Resume using {VisualResume}

```{r, include = F}
p_load(VisualResume)

VisualResume::VisualResume(
titles.left = c("Walter White, PhD", 
                "Chemistry, Cooking, Pizza", 
                "*Built with love in R using the VisualResume package: www.ndphillips.github.io/VisualResume"),
titles.left.cex = c(3, 2.5, 1),
titles.right.cex = c(3, 2.5, 1),
titles.right = c("www.lospolloshermanos.com", 
                 "TheOneWhoKnocks@gmail.com", 
                 "Full Resume: https://ndphillips.github.io/cv.html"),
timeline.labels = c("Education", "Employment"),
timeline = data.frame(title = c("Grinnell Col", "Ohio U", "U of Basel",
                                "Max Planck Institute", "Old Van", "Gray Matter",
                                "Sandia Laboratories", "J.P. Wynne High School", "A1A Car Wash"),
                      sub = c("BA. Student", "MS. Student", "PhD. Student", 
                              "PhD. Researcher", "Methamphetamine Research", "Co-Founder", 
                              "Chemist", "Chemistry Teacher", "Co-Owner"),
                      start = c(1976, 1980.1, 1982.2, 1985, 
                                1996.5, 1987, 1991, 1995, 2001),
                      end = c(1980, 1982, 1985, 1987, 1998, 
                              1992, 1995, 1998, 2003),
                      side = c(1, 1, 1, 1, 1, 0, 0, 0, 0)),
milestones = data.frame(title = c("BA", "MS", "PhD"),
                        sub = c("Math", "Chemistry", "Chemistry"),
                        year = c(1980, 1982, 1985)),
events = data.frame(year = c(1985, 1995, 1997, 1999, 2000),
                    title = c("Contributed to Nobel Prize winning experiment.",
                              "Honorary mention for best Chemistry teacher of the year.",
                              "Created Blue Sky, the most potent methamphetamine ever produced.",
                              "Made first $1,000,000.",
                              "White, W., & Pinkman, J. (2000). Blue Sky: A method of [...].\nJournal of Psychopharmical Substances, 1(1),.")),
interests = list("programming" = c(rep("R", 10), rep("Python", 1), rep("JavaScript", 2), "MatLab"),
                 "statistics" = c(rep("Trees", 10), rep("Bayesian", 5), rep("Regression", 3)),
                 "leadership" = c(rep("Motivation", 10), rep("Decision Making", 5), rep("Manipulation", 30)),
                 "Chemistry" = c(rep("Bio", 10), rep("Pharmaceuticals", 50))),
year.steps = 2
)
```

```{r}

events <- data.frame(
  year = c(2013, 2014, 2015, 2016, 2017.5),
  title = c("SPaT T32", "AHA F31", "NRSA F31", "Dissertation Defense", "ACRI Pilot")
)

VisualResume(
  titles.left = c("Clark Sims, PhD",
                  "Assistant Staff Scientist", 
                  "Arkansas Children's Nutrition Center/University of Arkansas for Medical Sciences"),
  titles.left.cex = c(3, 2, 2),
  titles.right = c(" ",
                   " ", 
                   " "),
  timeline = data.frame(title = c("Hendrix", "UAMS", "UAMS", "ACNC", "UAMS"),
                        sub = c("BA Student", "PhD Student", "Postdoctoral Fellow",
                                "Senior Research Associate", "Assistant Staff Scientist"),
                        start = c(2008.5, 2012.5, 2016, 2018, 2020),
                        end = c(2012.5, 2016, 2018, 2020, 2021),
                        side = c(1, 1, 0, 0, 0)),
  timeline.labels = c("Education", "Employment"),
  milestones = data.frame(
    title = c("BA", "PhD"),
    sub = c("Chemistry", "Pharmacology"),
    year = c(2012.5, 2016)
  ),
  events = events,
  col = c("darkorange2", "darkred", "darkred", "deepskyblue", "darkred"),
  interests = list("Data Analysis", "R", " "),
  year.steps = 1
)
```


# 20210906 - Labor Day Holiday
# 20210907 - #TidyTuesday and Formula 1 Races

```{r, include = F}
p_load(tidytuesdayR)

tt <- tt_load("2021-09-07")
readme(tt)


driver_results_df <- tt$driver_standings %>% 
  left_join(tt$races, by = "raceId") %>% 
  rename(driver_url = url) %>% 
  left_join(tt$drivers, by = "driverId")

skim(driver_results_df)

```

```{r}
driver_results_df %>% 
  distinct(driverId, .keep_all = T) %>% 
  count(nationality) %>% 
  ggplot(aes(n, reorder(nationality, n))) + 
  geom_point() + 
  labs(y = NULL, x = "Number of F1 Drivers from Each Nation")
```



# 20210908 - trying {medicaldata} for data and {paletteer} for plots

```{r, include = F}
p_load(medicaldata, paletteer, broom, gt)

supraclavicular <- supraclavicular %>% 
  mutate(group = case_when(group == 1 ~ "A",
                           group == 2 ~ "B"))

supraclavicular %>% 
  ggplot(aes(group, bmi, fill = group)) + 
  geom_boxplot() + 
  ggpubr::stat_compare_means() +
  scale_fill_paletteer_d("LaCroixColoR::Pure")

```

```{r}
model <- lm(onset_sensory ~ group + bmi + gender + opioid_total, data = supraclavicular)
tidy(model) %>% gt()

supraclavicular %>% 
  ggplot(aes(onset_sensory, opioid_total, fill = group)) + 
  geom_smooth(method = "lm", se = F, aes(color = group)) +
  geom_point(shape = 21, alpha = 0.5, position = position_jitter()) +
  labs(y = "Total Opioid Consumption (mg)", x = "Time to 4 Nerve Sensory Block Onset (min)")



```



# 20210909 - Nothing 

Used `R` for work though.

# 20210910 -  trying {gtsummary}

```{r}
p_load(gtsummary, broom)

# skim(trial)

mod1 <- trial %>% 
  lm(ttdeath ~ trt + marker + age + grade, data = .)

tidy(mod1)

mod1 %>% 
  tbl_regression() %>% 
  bold_labels() %>% 
  bold_p(t = 0.1) %>% 
  add_global_p(keep = T) %>% 
  add_q() %>% 
  as_flex_table()

```

# 20210913 - trying {gtExtras}

```{r}
p_load(gtExtras, gt, palmerpenguins)

penguins %>% 
  filter(!is.na(sex)) %>% 
  group_by(species, sex) %>% 
  summarize(across(bill_length_mm:body_mass_g, mean, na.rm = T)) %>% 
  mutate(across(where(is.numeric), round, 2)) %>% 
  t() %>% 
  as.data.frame() %>% 
  rownames_to_column() %>% 
  mutate(rowname = str_to_title(rowname)) %>% 
  gt() %>% 
#  opt_table_lines() %>% 
  gt_theme_nytimes()

```

# 20210914 - #TidyTuesday and Billboard Top 100

```{r, include = F}
p_load(tidytuesdayR, parameters, correlation, see, ggraph)

tt <- tt_load("2021-09-14")
readme(tt)

bb100 <- left_join(tt$billboard, tt$audio_features)

# skim(bb100)

bb100_md <- bb100 %>% 
  distinct(song_id, .keep_all = T) %>% 
  select(week_id, song, performer, song_id, peak_position, weeks_on_chart,
         danceability, energy, key, loudness, mode, speechiness, acousticness,
         instrumentalness, liveness, valence, tempo, time_signature)

```

```{r}
cor_data <- bb100_md %>% 
  correlation() %>% 
  tibble()

bb100_md %>% 
  correlation() %>% 
  summary() %>% 
  plot()

bb100_md %>% 
  correlation() %>% 
  plot()

cor_data_sum <- bb100_md %>% 
  correlation() %>% 
  tibble() %>% 
  filter(p > 0.5)

not_cor <- c(cor_data_sum$Parameter1, cor_data_sum$Parameter2)

lm_data <- bb100_md %>%
  select(week_id, song, performer, song_id, matches(not_cor))

# lm_1 <- lm_data %>%
#   select(-c(song, performer, weeks_on_chart)) %>%
#   lm(peak_position ~ ., data = .)

```

# 20210915 - More #TidyTuesday

```{r}
bb100 %>% 
  mutate(across(where(is.numeric), scale)) %>% 
  ggplot() + 
#  geom_point(alpha = 0.2, shape = 1) + 
  geom_smooth(aes(valence, weeks_on_chart), method = "lm", se = F, color = "blue") +
  geom_smooth(aes(danceability, weeks_on_chart), method = "lm", se = F, color = "red") +
  geom_smooth(aes(energy, weeks_on_chart), method = "lm", se = F, color = "green") +
  geom_smooth(aes(key, weeks_on_chart), method = "lm", se = F, color = "black") +
  geom_smooth(aes(loudness, weeks_on_chart), method = "lm", se = F, color = "yellow") +
  geom_smooth(aes(mode, weeks_on_chart), method = "lm", se = F, color = "orange") +
  geom_smooth(aes(instrumentalness, weeks_on_chart), method = "lm", se = F, color = "purple") + 
  labs(x = NULL)

bb100_l <- bb100 %>% 
  select(song_id, weeks_on_chart, 17:27) %>% 
  mutate(across(where(is.numeric), scale)) %>% 
  pivot_longer(-c(song_id, weeks_on_chart)) %>% 
  rename(trait = name)

bb100_l %>% 
  filter(!trait %in% c("key", "tempo")) %>% 
  ggplot(aes(value, weeks_on_chart, color = trait)) + 
  geom_smooth(method = "lm", se = F) + 
  scale_color_paletteer_d(palette = "palettetown::charizard")


```

# 20210916 - GIT

```{r, include = F, eval = F}
p_load(usethis, gitcreds)

use_git_config(user.name = "simscr", user.email = "simscr90@gmail.com")


# edit_git_config()

# create_github_token()

gitcreds_get()

gitcreds::gitcreds_set()

gh_token_help()

gh::gh_whoami()

git_sitrep()

```


# 20210917 - try {tidylog}

```{r}
p_load(tidylog)

```


# Ideas

template, officedown/officer, glue/, gluedown, tidymodels, ggsankey, groundhog, ezknitr, rprojroot, colorspace, rgbif, polite (web scraping), geoviz, magick, ggmap, ggstream, rayvista, circlize, camcorder, {renv}, {rayvertex}, {labelled}, {report}, {insight}, {performance}, {parameters}, {correlation}, {easystats}, {hrbrthemes}, {firatheme}, {pwr}, voronoi, {reprex}, {ggdag}, {dotwhisker}, {infer}, {aRtsy}, debug = T for geom_text, {Lahman}

<https://www.swisstopo.admin.ch/>

<https://www.ign.es/web/ign/portal/cbg-area-cartografia>

<http://shadedrelief.com/SampleElevationModels/>

<https://www.neonscience.org/resources/learning-hub/tutorials>

<https://docs.ropensci.org/rgbif/articles/rgbif.html>

<https://ryo-n7.github.io/2020-05-14-webscrape-soccer-data-with-R/>

<https://github.com/gkaramanis/aRt/blob/master/split-bar/split-bar.R>

<https://www.tidymodels.org/>

<https://rstudio.github.io/distill/basics.html>

<https://github.com/thebioengineer/camcorder>

<https://gist.github.com/Worville/c4149ece45a75928a404d316151ba0fe>